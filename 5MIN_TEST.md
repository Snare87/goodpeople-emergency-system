# 🚀 5분 안에 AI 선택 시스템 테스트하기!

## 🎯 빠른 시작 (전체 5분)

### 1분: 시스템 준비
```bash
# 웹 대시보드 실행
cd C:\goodpeople-emergency-system\packages\web-dashboard
npm start

# 별도 터미널에서 모바일 앱 실행 (선택사항)
cd packages/mobile-responder
flutter run
```

### 2분: 재난 발생 및 호출
1. **웹 로그인**: admin@korea.kr
2. **재난 선택** → "호출하기" 클릭
3. **상태 확인**: "출동요청" 상태로 변경됨

### 3분: 후보자 테스트 🤖

#### 방법 1: Firebase Console에서 직접 추가
`calls/[재난ID]/candidates`에 여러 후보자 추가:

**화재 재난 테스트 후보자 (최적)**
```json
{
  "userId": "User001",
  "name": "김철수",
  "position": "화재진압대원",
  "rank": "소방장",
  "acceptedAt": 1748700000000,
  "certifications": ["화재대응능력 1급", "응급구조사 2급"],
  "routeInfo": {
    "distance": 1500,
    "distanceText": "1.5km",
    "duration": 180,
    "durationText": "3분"
  }
}
```

**자격증 중복 테스트 후보자**
```json
{
  "userId": "User002",
  "name": "박지훈",
  "position": "구급대원",
  "rank": "소방위",
  "acceptedAt": 1748700050000,
  "certifications": [
    "화재대응능력 1급", 
    "화재대응능력 2급", // 1급이 있으므로 무시됨
    "간호사",
    "응급구조사 1급",      // 간호사와 중 하나만 적용
    "응급구조사 2급"       // 1급이 있으므로 무시됨
  ],
  "routeInfo": {
    "distance": 2000,
    "distanceText": "2.0km",
    "duration": 240,
    "durationText": "4분"
  }
}
```

**구급 재난 테스트 후보자**
```json
{
  "userId": "User003", 
  "name": "이영희",
  "position": "구급대원",
  "rank": "소방교",
  "acceptedAt": 1748700100000,
  "certifications": ["응급구조사 1급", "간호사"],
  "routeInfo": {
    "distance": 3000,
    "distanceText": "3.0km",
    "duration": 420,
    "durationText": "7분"
  }
}
```

#### 방법 2: 모바일 앱에서 수락
- 여러 모바일 기기/에뮬레이터에서 재난 수락
- 자동으로 경로 계산되어 candidates에 추가됨

### 4분: AI 자동 선택 테스트 ⏱️
1. **후보자 목록 확인**
   - AI 점수순으로 자동 정렬
   - 상위 3명에 "최적" 배지 표시
   - 🔥🚨🚑 재난 종류별 자격증 중요도 표시
   
2. **자동 선택 활성화**
   - "자동 선택" 체크박스 클릭
   - 60초 카운트다운 시작
   - 최적 후보자가 "자동 선택 예정" 표시됨

3. **수동 선택 (선택사항)**
   - 원하는 대원의 "선택" 버튼 클릭
   - 자동 선택이 즉시 중단됨

### 5분: 결과 확인 ✅
- **선택된 대원**: selectedResponder에 저장됨
- **상태 변경**: "출동중"으로 변경
- **지도 연동**: 후보자 클릭 시 위치로 이동

## 🔍 확인 포인트

### AI 점수 계산 확인

#### 화재 재난 예시
```
김철수 (화재 전문가)
- 도착시간: 3분(180초) → 180점
- 거리: 1.5km → 0.75점
- 자격증: 화재대응능력 1급(30) + 응급구조사 2급(5) → -35점
- 계급: 소방장(2) → -1점
- 총점: 180 + 0.75 - 35 - 1 = 144.75점 ✨

박지훈 (자격증 중복)
- 도착시간: 4분(240초) → 240점
- 거리: 2.0km → 1점
- 자격증 처리:
  • 화재대응능력 1급(30) ✓ [화재2급 무시]
  • 간호사(10) 또는 응급구조사 1급(10) 중 하나만 → 10점
  • 총 자격증 점수: 40점
- 계급: 소방위(3) → -1.5점
- 총점: 240 + 1 - 40 - 1.5 = 199.5점
```

#### 구급 재난 예시
```
이영희 (구급 전문가)
- 도착시간: 7분(420초) → 420점
- 거리: 3km → 1.5점
- 자격증: 
  • 응급구조사 1급(30) vs 간호사(30) → 30점만 (중복 제거)
- 계급: 소방교(1) → -0.5점
- 총점: 420 + 1.5 - 30 - 0.5 = 391점
```

### UI 확인사항
- ✅ 최적 대원 파란색 배경
- ✅ AI 점수 및 추천 이유 표시
- ✅ 자격증 정보 표시
- ✅ 카운트다운 표시 (자동 선택 시)
- ✅ 지도 이동 기능
- ✅ 재난 종류별 자격증 중요도 안내

## ❌ 문제 해결

### 후보자가 안 보일 때
1. Firebase Console에서 candidates 구조 확인
2. 브라우저 새로고침 (F5)
3. 콘솔 에러 확인 (F12)

### 자동 선택이 안 될 때
1. 후보자가 1명 이상인지 확인
2. 카운트다운이 0이 되었는지 확인
3. 네트워크 연결 상태 확인

### AI 점수가 이상할 때
1. routeInfo 데이터 확인 (duration은 초 단위)
2. certifications 배열 확인 (정확한 자격증명)
3. 재난 종류(eventType) 확인
4. 사용자 정보(users 컬렉션) 확인

## 🚀 고급 테스트

### 다양한 시나리오
1. **화재 긴급**: 화재대응능력 보유 대원 우선
2. **구급 상황**: 응급구조사/간호사 우선
3. **구조 작업**: 인명구조사 자격증 우선

### 성능 테스트
- 10명 이상 후보자 추가
- AI 점수 계산 속도 확인
- UI 반응성 확인

---

**팁**: Chrome DevTools의 Network 탭에서 Firebase 실시간 업데이트를 확인할 수 있습니다! 🔥

## 🎆 자격증 상하위 관계 및 중복 처리

### 상하위 관계
- **화재대응능력**: 1급 보유 시 2급 무시
- **인명구조사**: 1급 보유 시 2급 무시
- **응급구조사**: 1급 보유 시 2급 무시

### 동일 업무 영역
- **간호사** ↔ **응급구조사 1급**: 둘 중 높은 점수 하나만 적용

### 테스트 예시
- 화재1급 + 화재2급 → 화재1급만
- 간호사 + 응급1급 + 응급2급 → 간호사 또는 응급1급 중 높은 점수

## 🎯 재난 종류별 자격증 중요도

- **화재 🔥**: 화재대응능력 > 인명구조 > 응급구조
- **구조 🚨**: 인명구조 > 응급구조 > 화재대응능력
- **구급 🚑**: 응급구조/간호사 > 인명구조 > 화재대응능력
- **기타 ⚠️**: 모든 자격증 동일 가중치

## 📋 프로젝트 자격증 목록
1. 응급구조사 1급
2. 응급구조사 2급
3. 간호사
4. 화재대응능력 1급
5. 화재대응능력 2급
6. 인명구조사 1급
7. 인명구조사 2급

---

**업데이트**: 자격증 상하위 관계 및 중복 처리 적용 (2025.02.01)

## 🆕 추가 처리 사항 (2025.02.01 오후)

### 경로 정보 없는 후보자
```json
{
  "userId": "User004",
  "name": "김서연",
  "position": "구급대원",
  "rank": "소방사",
  "acceptedAt": 1748700200000,
  "certifications": ["간호사", "응급구조사 1급"]
  // routeInfo 없음 - AI 점수 "경로정보 없음"으로 표시
}
```

### 테스트 특이사항
- **최적 대원**: 현재 1명만 표시 (테스트용)
- **AI 점수 50000 이상**: "경로정보 없음" 표시
- **실제 사용 시**: aiScoringService.ts에서 `index < 3`으로 변경
